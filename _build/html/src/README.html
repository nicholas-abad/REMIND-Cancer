<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>REMIND-Cancer Pipeline &#8212; REMIND-Cancer 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=27fed22d" />
    <script src="../_static/documentation_options.js?v=f2a433a1"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="remind-cancer-pipeline">
<h1>REMIND-Cancer Pipeline<a class="headerlink" href="#remind-cancer-pipeline" title="Link to this heading">¶</a></h1>
<section id="general-overview">
<h2>General Overview<a class="headerlink" href="#general-overview" title="Link to this heading">¶</a></h2>
<p>This directory includes three key subfolders: <code class="docutils literal notranslate"><span class="pre">utils</span></code>, <code class="docutils literal notranslate"><span class="pre">pipeline_setup</span></code>, and <code class="docutils literal notranslate"><span class="pre">pipeline</span></code>, which together comprise the core of the REMIND-Cancer pipeline.</p>
<p>To ensure smooth execution, start by running the functions in the <code class="docutils literal notranslate"><span class="pre">utils</span></code> folder. These will verify the compatibility of your input data and configuration files. Once validation is complete, proceed to initialize the pipeline using the code in <code class="docutils literal notranslate"><span class="pre">pipeline_setup</span></code> and finally execute the main filtering process located in the <code class="docutils literal notranslate"><span class="pre">pipeline</span></code> folder.</p>
<p>After the filtering process is complete, two main output files are generated:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">final_results_XX-XX-20XX_XX:XX.csv</span></code>: This file consolidates all mutations that pass through the pipeline. Entries are ranked in descending order by their REMIND-Cancer score, which reflects the likelihood that a mutation activates its associated gene. Each entry includes additional annotations such as recurrence frequency, known cancer gene association, and overlap with open chromatin regions.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">results.json</span></code>: This file tracks the progress of each sample throughout the pipeline. For every preprocessing, filtering, or annotation step, the file maps the current version of each mutation file to its sample type—whether it’s a primary or metastatic tumor, and whether RNA-Seq data is available alongside WGS data. After each stage, a new file is generated with an updated suffix and logged accordingly.</p></li>
</ul>
<p>Below is a snapshot of the <code class="docutils literal notranslate"><span class="pre">final_results</span></code> CSV:</p>
<p align="center">
   <img src="./assets/final_results_snapshot.png">
</p>
<p>Example <code class="docutils literal notranslate"><span class="pre">results.json</span></code> for a case where a mutation passes preprocessing and promoter filtering, but fails the TF Expression and Motif filter:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;original&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;primary_tumor_wgs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">        </span><span class="nt">&quot;primary_tumor_wgs_and_rnaseq&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;/path/to/some/sample1_original.vcf&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="nt">&quot;metastasic_tumor_wgs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">        </span><span class="nt">&quot;metastasic_tumor_wgs_and_rnaseq&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;_original_after_preprocessing.vcf&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;primary_tumor_wgs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">        </span><span class="nt">&quot;primary_tumor_wgs_and_rnaseq&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;/path/to/some/sample1_original_after_preprocessing.vcf&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="nt">&quot;metastasic_tumor_wgs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">        </span><span class="nt">&quot;metastasic_tumor_wgs_and_rnaseq&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;_original_after_preprocessing_after_promoter_1000up_500down.vcf&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;primary_tumor_wgs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">        </span><span class="nt">&quot;primary_tumor_wgs_and_rnaseq&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;/path/to/some/sample1_original_after_preprocessing_after_promoter_1000up_500down.vcf&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="nt">&quot;metastasic_tumor_wgs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">        </span><span class="nt">&quot;metastasic_tumor_wgs_and_rnaseq&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;_original_after_preprocessing_after_promoter_1000up_500down_after_tf_and_motif_filter.vcf&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;primary_tumor_wgs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">        </span><span class="nt">&quot;primary_tumor_wgs_and_rnaseq&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">        </span><span class="nt">&quot;metastasic_tumor_wgs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">        </span><span class="nt">&quot;metastasic_tumor_wgs_and_rnaseq&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Only the final files listed in this JSON will be included in the aggregated <code class="docutils literal notranslate"><span class="pre">final_results</span></code> CSV.</p>
</section>
<hr class="docutils" />
<section id="details-of-each-subfolder">
<h2>Details of Each Subfolder<a class="headerlink" href="#details-of-each-subfolder" title="Link to this heading">¶</a></h2>
<section id="utils">
<h3>1. Utils<a class="headerlink" href="#utils" title="Link to this heading">¶</a></h3>
<p>Within this subfolder, three validation checks can be ran in order to verify that your configuration file, metadata file and RNA-Seq dataframe are all in order and in the proper format.</p>
<section id="configuration-file">
<h4>Configuration File<a class="headerlink" href="#configuration-file" title="Link to this heading">¶</a></h4>
<p>This file contains keys and values that the pipeline relies on in order to get proper paths for files, output files and proper endings of intermediate files. An example of this can be found in <code class="docutils literal notranslate"><span class="pre">REMIND-Camcer/examples/results/21March2025/configuration_file.json</span></code>.</p>
</section>
<section id="metadata-file">
<h4>Metadata file<a class="headerlink" href="#metadata-file" title="Link to this heading">¶</a></h4>
<p>An example of a properly-formatted metadata file can be found at <code class="docutils literal notranslate"><span class="pre">data/annotations/metadata_with_local.csv</span></code> and can be validated using the script at <code class="docutils literal notranslate"><span class="pre">utils/validate_metadata_file.py</span></code>.</p>
<p>This validation script checks the following:</p>
<ul class="simple">
<li><p>That the metadata file exists and can be loaded properly as a CSV.</p></li>
<li><p>That it contains all required columns: <code class="docutils literal notranslate"><span class="pre">pid</span></code>, <code class="docutils literal notranslate"><span class="pre">tumor_origin</span></code>, <code class="docutils literal notranslate"><span class="pre">path_to_wgs_file</span></code>, <code class="docutils literal notranslate"><span class="pre">cohort</span></code>, and <code class="docutils literal notranslate"><span class="pre">ge_data_available</span></code>.</p>
<ul>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">pid</span></code></strong>: A unique identifier for each sample.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">tumor_origin</span></code></strong>: Must be either <code class="docutils literal notranslate"><span class="pre">primary_tumor</span></code> or <code class="docutils literal notranslate"><span class="pre">metastatic_tumor</span></code>.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">path_to_wgs_file</span></code></strong>: The accessible, tab-delimited VCF file path for each sample’s WGS SNV data.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">cohort</span></code></strong>: Indicates the cohort the sample belongs to (if applicable).</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">ge_data_available</span></code></strong>: A boolean value (<code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code>) indicating whether RNA-Seq data is available. If <code class="docutils literal notranslate"><span class="pre">True</span></code>, the sample must have a matching entry in the RNA-Seq dataframe (explained below).</p></li>
</ul>
</li>
<li><p>That the files specified in the <code class="docutils literal notranslate"><span class="pre">path_to_wgs_file</span></code> column exist.</p></li>
<li><p>That associated VCF files (with the same name but <code class="docutils literal notranslate"><span class="pre">.vcf</span></code> extension) are also present and contain all required columns: <code class="docutils literal notranslate"><span class="pre">#CHROM</span></code>, <code class="docutils literal notranslate"><span class="pre">POS</span></code>, <code class="docutils literal notranslate"><span class="pre">REF</span></code>, <code class="docutils literal notranslate"><span class="pre">ALT</span></code>, <code class="docutils literal notranslate"><span class="pre">SEQUENCE_CONTEXT</span></code>, and <code class="docutils literal notranslate"><span class="pre">GENE</span></code>.</p></li>
</ul>
<p>Any missing columns or files are reported in the terminal, making this a useful first step for debugging input setup.</p>
</section>
<section id="rna-seq-dataframe">
<h4>RNA-Seq Dataframe<a class="headerlink" href="#rna-seq-dataframe" title="Link to this heading">¶</a></h4>
<p>An example of a properly-formatted RNA-Seq file can be found at <code class="docutils literal notranslate"><span class="pre">data/rna_seq_data/_fpkm_dataframe.csv</span></code> and can be validated using the script at <code class="docutils literal notranslate"><span class="pre">utils/validate_rnaseq_dataframe.py</span></code>.</p>
<p>This validation script performs the following checks:</p>
<ul class="simple">
<li><p>Ensures the RNA-Seq file exists and is accessible.</p></li>
<li><p>Attempts to load the file as a comma-delimited CSV.</p></li>
<li><p>Verifies the presence of the required <code class="docutils literal notranslate"><span class="pre">pid</span></code> column, which links each RNA-Seq entry to a corresponding sample in the metadata.</p></li>
<li><p>Counts and reports the number of unique <code class="docutils literal notranslate"><span class="pre">pid</span></code> entries (samples) and the number of genes (all columns except <code class="docutils literal notranslate"><span class="pre">pid</span></code>).</p></li>
</ul>
<p>If the file is missing, improperly formatted, or lacks the <code class="docutils literal notranslate"><span class="pre">pid</span></code> column, the script will output a descriptive error message to aid in troubleshooting.</p>
<p>Below is a snapshot of an RNA-Seq dataframe:</p>
<p align="center">
   <img src="./assets/rnaseq_snapshot.png">
</p>
</section>
</section>
<section id="pipeline-setup">
<h3>2. Pipeline Setup<a class="headerlink" href="#pipeline-setup" title="Link to this heading">¶</a></h3>
<p>The scripts in this subfolder handle the initial setup required for running the REMIND-Cancer pipeline. These include organizing patient files and generating the initial tracking JSON file.</p>
<section id="create-initial-structure-py">
<h4><code class="docutils literal notranslate"><span class="pre">create_initial_structure.py</span></code><a class="headerlink" href="#create-initial-structure-py" title="Link to this heading">¶</a></h4>
<p>This script prepares your dataset by creating patient-specific directories and initializing the tracking JSON file used throughout the REMIND-Cancer pipeline.</p>
<ol class="arabic">
<li><p><strong>Create Folder Structure</strong>Using information from the metadata file, this step creates a folder for each sample using the format <code class="docutils literal notranslate"><span class="pre">{pid}_{tumor_origin}</span></code>. Inside each folder, it copies the sample’s original <code class="docutils literal notranslate"><span class="pre">.vcf</span></code> file and renames it to end with <code class="docutils literal notranslate"><span class="pre">_original.vcf</span></code>. If a listed VCF file cannot be found, a warning is printed, and the script continues.</p></li>
<li><p><strong>Generate <code class="docutils literal notranslate"><span class="pre">results.json</span></code> File</strong>This step scans the created folders and categorizes each sample’s VCF into one of four groups based on <code class="docutils literal notranslate"><span class="pre">tumor_origin</span></code> and the availability of RNA-Seq data:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">primary_tumor_wgs</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">primary_tumor_wgs_and_rnaseq</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">metastasic_tumor_wgs</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">metastasic_tumor_wgs_and_rnaseq</span></code></p></li>
</ul>
<p>These are saved under the <code class="docutils literal notranslate"><span class="pre">original</span></code> key in <code class="docutils literal notranslate"><span class="pre">results.json</span></code>, which is written to the path specified in the configuration file.</p>
</li>
</ol>
<section id="example">
<h5>Example<a class="headerlink" href="#example" title="Link to this heading">¶</a></h5>
<p>Suppose your metadata file contains the following rows:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>pid</p></th>
<th class="head"><p>tumor_origin</p></th>
<th class="head"><p>path_to_wgs_file</p></th>
<th class="head"><p>ge_data_available</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>SampleA</p></td>
<td><p>primary_tumor</p></td>
<td><p>/path/to/SampleA.vcf</p></td>
<td><p>False</p></td>
</tr>
<tr class="row-odd"><td><p>SampleB</p></td>
<td><p>metastatic_tumor</p></td>
<td><p>/path/to/SampleB.vcf</p></td>
<td><p>False</p></td>
</tr>
</tbody>
</table>
<p>After running the script, your output directory will look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>output_folder/
├── SampleA_primary_tumor/
│   └── SampleA_original.vcf
└── SampleB_metastatic_tumor/
    └── SampleB_original.vcf
</pre></div>
</div>
<p>The resulting <code class="docutils literal notranslate"><span class="pre">results.json</span></code> will contain:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;results&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;original&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;primary_tumor_wgs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;/absolute/path/to/output_folder/SampleA_primary_tumor/SampleA_original.vcf&quot;</span><span class="p">],</span>
<span class="w">            </span><span class="nt">&quot;primary_tumor_wgs_and_rnaseq&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">            </span><span class="nt">&quot;metastasic_tumor_wgs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;/absolute/path/to/output_folder/SampleB_metastatic_tumor/SampleB_original.vcf&quot;</span><span class="p">],</span>
<span class="w">            </span><span class="nt">&quot;metastasic_tumor_wgs_and_rnaseq&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To run this setup, use the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">pipeline_setup</span><span class="o">/</span><span class="n">create_initial_structure</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">c</span> <span class="o">&lt;</span><span class="n">path_to_configuration_file</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This setup must be completed before running any downstream pipeline components.</p>
</section>
</section>
</section>
<section id="pipeline">
<h3>3. Pipeline<a class="headerlink" href="#pipeline" title="Link to this heading">¶</a></h3>
<p>The core functionality of the pipeline resides in the pipeline subfolder, which is organized into four main components: <code class="docutils literal notranslate"><span class="pre">annotations</span></code>, <code class="docutils literal notranslate"><span class="pre">filters</span></code>, <code class="docutils literal notranslate"><span class="pre">postprocessing</span></code>, and <code class="docutils literal notranslate"><span class="pre">preprocessing</span></code>. Each of these contains additional subfolders representing specific steps (e.g., <code class="docutils literal notranslate"><span class="pre">promoter_filter</span></code> which is in the <code class="docutils literal notranslate"><span class="pre">filters</span></code> subfolder). For every step, there are typically two associated Python scripts: one that executes the step for a <em>single</em> WGS file and another that iterates over multiple samples. This structure supports efficient parallelization, which is particularly useful when submitting jobs to a compute cluster, and makes it easy to isolate and re-run individual steps in case of errors.</p>
<p>An overview of the steps within each subfolder can be seen here:</p>
<section id="preprocessing">
<h4>Preprocessing<a class="headerlink" href="#preprocessing" title="Link to this heading">¶</a></h4>
<p>This step prepares each VCF file for downstream analysis by performing multiple cleanup, normalization, and annotation tasks. It consists of two main scripts:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">_run_preprocessing_on_single_path.py</span></code>: Applies preprocessing logic to a single sample.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">run_preprocessing_on_all_paths.py</span></code>: Iterates over all samples defined in the <code class="docutils literal notranslate"><span class="pre">results.json</span></code> file and applies the single-sample script, optionally on a computing cluster.</p></li>
</ul>
<p>The main preprocessing tasks include:</p>
<ul class="simple">
<li><p><strong>Gene name cleanup</strong>: Renames misformatted gene names (e.g., removes transcripts or distance annotations in parentheses).</p></li>
<li><p><strong>Filtering</strong>:</p>
<ul>
<li><p>Removes rows with missing or invalid gene names (e.g., <code class="docutils literal notranslate"><span class="pre">NONE</span></code>, <code class="docutils literal notranslate"><span class="pre">Unknown</span></code>).</p></li>
<li><p>Filters out indels by retaining only SNVs (i.e., where both REF and ALT have length 1).</p></li>
<li><p>Removes germline variants based on reclassification labels (if present).</p></li>
</ul>
</li>
<li><p><strong>Annotation</strong>:</p>
<ul>
<li><p>Adds sequence context around the SNV site for PCAWG samples (generating the <code class="docutils literal notranslate"><span class="pre">SEQUENCE_CONTEXT</span></code> column).</p></li>
<li><p>Annotates each mutation with sample-specific purity and allele frequency.</p></li>
<li><p>Adds transcription factor binding site predictions using FIMO and a JASPAR motif database.</p></li>
<li><p>Cleans TF names (e.g., removes lowercase names, parentheses, and compound TF names like <code class="docutils literal notranslate"><span class="pre">FOSL1::JUND</span></code>).</p></li>
<li><p>Annotates each gene and transcription factor with raw, Z-score, and log-transformed expression values if RNA-Seq data is available.</p></li>
</ul>
</li>
<li><p>The full output is saved to a new VCF file with a suffix defined in the configuration file, and this output path is logged in the <code class="docutils literal notranslate"><span class="pre">results.json</span></code> file.</p></li>
</ul>
</section>
<section id="filters">
<h4>Filters<a class="headerlink" href="#filters" title="Link to this heading">¶</a></h4>
<p>This subfolder contains the different filtering steps of the REMIND-Cancer pipeline. A description of each implemented feature can be seen below:</p>
</section>
<section id="promoter-filter">
<h4><code class="docutils literal notranslate"><span class="pre">promoter_filter</span></code>:<a class="headerlink" href="#promoter-filter" title="Link to this heading">¶</a></h4>
<p>This step filters mutations based on whether they fall within defined promoter regions surrounding transcription start sites (TSS). The promoter region is specified in the configuration file by upstream (<code class="docutils literal notranslate"><span class="pre">pipeline.promoter.upstream_of_tss</span></code>) and downstream (<code class="docutils literal notranslate"><span class="pre">pipeline.promoter.downstream_of_tss</span></code>) base-pair distances from the TSS. Two scripts implement this functionality:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">_run_promoter_on_single_file.py</span></code>: Filters for mutations that lie within the promoter boundaries (inclusive) and writes a filtered file with the additional suffix to append (<code class="docutils literal notranslate"><span class="pre">pipeline.promoter.suffix_to_append</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">run_promoter_on_all_paths.py</span></code>: Applies the filtering to all mutation files in the current pipeline stage, either locally or via job submission to a compute cluster.</p>
<p>The filter works by comparing each mutation’s genomic position and gene symbol to promoter intervals defined in a TSS reference file. Mutations that match the same chromosome, gene, and lie within the computed promoter window are retained. The resulting filtered file is saved with a suffix (e.g., <code class="docutils literal notranslate"><span class="pre">_after_promoter_1000up_500down.vcf</span></code>) and its path is updated in <code class="docutils literal notranslate"><span class="pre">results.json</span></code>. This step also considers the positive or negative strand to calculate the promoter regions.
<br></p>
</li>
</ul>
</section>
<section id="motif-and-tf-filter">
<h4><code class="docutils literal notranslate"><span class="pre">motif_and_tf_filter</span></code>:<a class="headerlink" href="#motif-and-tf-filter" title="Link to this heading">¶</a></h4>
<p>This step filters mutations based on transcription factor binding site (TFBS) predictions and transcription factor (TF) expression levels. It uses two main scripts:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">_run_motif_and_tf_on_single_file.py</span></code>: Applies the combined motif and expression-based filtering logic to a single VCF.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">run_all_motif_and_tf_expression_on_all_paths.py</span></code>: Applies the filter to all samples in the current pipeline stage listed in <code class="docutils literal notranslate"><span class="pre">results.json</span></code>.</p></li>
</ul>
<p>During the preprocessing stage, FIMO is called with a TF collection (e.g. JASPAR2022) in order to predict the binding affinity of TFBS’ to both the wildtype (according to a given reference file such as hg19) $ba_{wt}$ and the mutant (sequence with the introduced mutation) $ba_{mut}$. As a mutation could affect multiple TFBSs, <em>each</em> TFBS has their own binding affinity. Next, the ratio between these two $\hat{ba} = \frac{ba_{mut}}{ba_{wt}} $ represents a binding affinity that’s used to approximate the likelihood of this singular mutation creating or destroying this TFBS. Using the two <em>TERT</em> pSNVs as a reference in which multiple ETS-factor TFBS’ are created, a $\hat{ba}$ of 11 (<code class="docutils literal notranslate"><span class="pre">pipeline.motif_and_tf_expression_filter.tfbs_creation_threshold</span></code>) is used to signify the creation of a TFBS whereas a $\hat{ba}$ of 0.09 (<code class="docutils literal notranslate"><span class="pre">pipeline.motif_and_tf_expression_filter.tfbs_destruction_threshold</span></code>) is used to signify the destruction of a TFBS. This information for each TFBS (separated by a ‘;’) is stored within its own column starting with <code class="docutils literal notranslate"><span class="pre">JASPAR2020_CORE_vertebrates_non-redundant</span></code>.</p>
<p>Now, within this filtering step, each mutation is assessed to determine whether it (1) creates or destroys <em>at least one</em> TFBS based on $\hat{ba}$ and if so, (2) has a detectable expression level (e.g. FPKM greater than 0). If at least one TFBS is either significantly created or destroyed and the corresponding TF has an expression value (raw, z-score, or log) above a configured threshold, the mutation is retained. Otherwise, it is filtered out.</p>
<p>Internally, the script parses TFBS annotations (produced during preprocessing via FIMO and JASPAR), evaluates them using motif and TF expression criteria, and appends the following new columns:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">created_tfs_passing_tf_expression_threshold</span></code>: The name of the TFs (comma separated) that have <em>both</em> a created binding site ($\hat{ba} \geq 11$) and an expression value above 0.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">destroyed_tfs_passing_tf_expression_threshold</span></code>: The name of the TFs (comma separated) that have <em>both</em> a destroyed binding site ($\hat{ba} \geq 11$) and an expression value above 0.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">remaining_tfs</span></code>: All other TFs that did not fall outside of the created/destroyed thresholds and/or had no expression levels.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">num_created_tfs_passing_tf_expression_threshold</span></code>: A count of the TFs in <code class="docutils literal notranslate"><span class="pre">created_tfs_passing_tf_expression_threshold</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">num_destroyed_tfs_passing_tf_expression_threshold</span></code>: A count of the TFs in <code class="docutils literal notranslate"><span class="pre">destroyed_tfs_passing_tf_expression_threshold</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">num_remaining_tfs</span></code>: A count of the TFs in <code class="docutils literal notranslate"><span class="pre">remaining_tfs</span></code></p></li>
</ul>
<p>Filtered files are saved with a configurable suffix (e.g., <code class="docutils literal notranslate"><span class="pre">_after_motif_and_tf_exp_filter.vcf</span></code>) and paths are logged in <code class="docutils literal notranslate"><span class="pre">results.json</span></code> under the new pipeline stage.</p>
</section>
<section id="ge-filter">
<h4><code class="docutils literal notranslate"><span class="pre">ge_filter</span></code>:<a class="headerlink" href="#ge-filter" title="Link to this heading">¶</a></h4>
<p>This filter step only keeps mutations that are associated with genes whose expression surpasses a threshold defined within the configuration file (<code class="docutils literal notranslate"><span class="pre">pipeline.ge_filter.threshold</span></code>). As the pipeline is trying to detect pSNVs that lead to a relative <em>upregulation</em>, the normalized expression (e.g. FPKM z-score) is, by default, the measurement that will be filtered. Two scripts implement this functionality:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">_run_ge_on_single_file.py</span></code>: Filters for mutations that lie within the promoter boundaries (inclusive) and writes a filtered file with the additional suffix to append (<code class="docutils literal notranslate"><span class="pre">pipeline.promoter.suffix_to_append</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">run_promoter_on_all_paths.py</span></code>: Applies the filtering to all mutation files in the current pipeline stage, either locally or via job submission to a compute cluster.
<br></p></li>
</ul>
</section>
<section id="annotations">
<h4>Annotations<a class="headerlink" href="#annotations" title="Link to this heading">¶</a></h4>
<ul>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">cgc_list</span></code></strong>:
This step annotates each mutation with whether it overlaps a gene listed in the Cancer Gene Census (CGC). It involves two scripts: one (<code class="docutils literal notranslate"><span class="pre">_add_cgc_information_to_single_file.py</span></code>) processes a single VCF file by adding a new column <code class="docutils literal notranslate"><span class="pre">within_cgc_list</span></code>, which is <code class="docutils literal notranslate"><span class="pre">True</span></code> if the mutation’s gene appears in the CGC dataset. The second script (<code class="docutils literal notranslate"><span class="pre">add_cgc_to_all_paths.py</span></code>) loops through all VCFs listed in the latest stage of <code class="docutils literal notranslate"><span class="pre">results.json</span></code>, runs the single-file script either locally or on a computing cluster, and saves the updated files with a user-defined suffix. The results are then tracked under a new key in <code class="docutils literal notranslate"><span class="pre">results.json</span></code>, allowing downstream steps to access CGC-annotated data.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">chromhmm</span></code></strong>:
This step annotates each mutation with whether it falls within a region of open chromatin, as defined by ChromHMM segmentations. It consists of two scripts: the single-sample script (<code class="docutils literal notranslate"><span class="pre">_add_chromhmm_to_single_file.py</span></code>) loads a VCF and a ChromHMM annotation file, checks whether each mutation lies within any annotated open chromatin regions, and appends a boolean column <code class="docutils literal notranslate"><span class="pre">open_chromatin</span></code> to the VCF. The batch script (<code class="docutils literal notranslate"><span class="pre">add_chromhmm_to_all_paths.py</span></code>) applies this logic across all relevant samples listed in the current stage of <code class="docutils literal notranslate"><span class="pre">results.json</span></code>, running either locally or on a cluster. Results are saved with a specified suffix and tracked under a new key in <code class="docutils literal notranslate"><span class="pre">results.json</span></code>, allowing downstream pipeline steps to access this annotation.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">recurrence</span></code></strong>:
This step determines whether a given mutation recurs across different samples in the dataset or in external datasets. It is composed of two scripts: one (<code class="docutils literal notranslate"><span class="pre">_add_recurrence_to_single_file.py</span></code>) processes a single VCF file by comparing each mutation to recurrence dictionaries—either computed from the current dataset or loaded from external JSONs. Mutations that appear at the same genomic position, with the same alternate allele and gene, but in different patients, are considered recurrent. A summary string of matching entries and a count of recurrent matches are appended as new columns. The second script (<code class="docutils literal notranslate"><span class="pre">add_recurrence_to_all_paths.py</span></code>) loops through all current VCF files in <code class="docutils literal notranslate"><span class="pre">results.json</span></code>, submits the single-file script either locally or to a cluster, and saves the updated output using a configured suffix. The recurrence step supports cohort-specific recurrence tracking and is logged as a new key in <code class="docutils literal notranslate"><span class="pre">results.json</span></code> for downstream use.</p>
<p>Internally, the recurrence step works by identifying mutations that share the same chromosome, genomic position, gene, and alternate allele across different patients. A recurrence dictionary is created from either the current dataset or supplemental datasets (if configured), and mutations are matched against this dictionary. For each match found, the pipeline appends two new columns: one containing a semicolon-separated list of matching mutation metadata (defined within configuration file under <code class="docutils literal notranslate"><span class="pre">recurrence.name_of_column_to_add</span></code>, which defaults to <code class="docutils literal notranslate"><span class="pre">paths_with_recurrence(format=path,pid,cohort,bp,ref,alt,gene,chr,raw_score,zscore,log_score,confidence,purity,af)</span></code>), and another recording the total number of recurrences. This enables downstream scoring steps to weigh recurrent mutations more heavily, improving prioritization of potentially driver events.</p>
</li>
</ul>
</section>
<section id="post-processing-steps">
<h4>Post-Processing Steps<a class="headerlink" href="#post-processing-steps" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">add_ncbi_and_tf_information</span></code></strong>:<br />
This step enriches the mutation file with descriptions for genes and transcription factors (TFs) based on the NCBI gene summary. For each row in the VCF, both the associated gene and any predicted TFs (extracted from the JASPAR annotation column) are cross-referenced with a user-provided JSON file that maps gene symbols to functional descriptions. A new column, <code class="docutils literal notranslate"><span class="pre">ncbi_gene_and_tf_summaries</span></code>, is added containing this information in dictionary format.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">add_tf_logo_plot</span></code></strong>:<br />
Each mutation’s TFBS predictions are further annotated with direct links to JASPAR sequence logo images. These logos help visualize the binding motifs of TFs predicted to be affected by the mutation. If the TF name is found in the downloaded JASPAR metadata, the corresponding sequence logo URL is appended to each entry in the TFBS prediction column.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">add_expression_traces</span></code></strong>:<br />
This step aggregates expression data across cohorts for each gene and TF associated with a mutation. For every row, the pipeline identifies recurrent cohorts and relevant genes/TFs, then collects raw, z-score, and log-transformed expression values from the RNA-Seq dataframe. These values are stored in the <code class="docutils literal notranslate"><span class="pre">expression_traces</span></code> column, enabling downstream review of expression variation across cohorts and samples. This step can be toggled off or on depending on memory and processing considerations.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">_add_num_original_promoter_and_final_mutations_to_single_patient_path</span></code></strong>:<br />
The pipeline logs how many mutations from each sample survive through different stages of the pipeline. For each mutation, columns are added to indicate the total number of mutations after preprocessing, after promoter filtering, and after the final stage. These counts provide a sense of pipeline attrition and help identify overly stringent filters.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">calculate_remind_score</span></code></strong>:<br />
The final scoring function combines multiple weighted features to generate a composite REMIND-Cancer score for each mutation. Genomic features (e.g., TFBS changes, recurrence, purity, allele frequency), transcriptomic expression, and binary annotations (e.g., CGC membership, open chromatin) are aggregated using weights defined in the configuration file. The final score is stored in a column named <code class="docutils literal notranslate"><span class="pre">score</span></code> and is used to rank mutations in the final results CSV.</p></li>
</ul>
</section>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">REMIND-Cancer</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Nicholas Allen Baclig Abad.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../_sources/src/README.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>